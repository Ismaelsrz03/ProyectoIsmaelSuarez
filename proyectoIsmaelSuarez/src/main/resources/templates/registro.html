<!DOCTYPE html>

<head th:insert="librerias">
</head>

<body style="background-color: #eee;">
<section class="h-100 gradient-form">
  <div class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center">
      <div class="col-xl-10">
        <div class="card rounded-3 text-black">
          <div class="row g-0">
<div class="col-lg-6 col-md-6 col-sm-12">
  <div class="card-body p-md-5 mx-md-4">

                <div class="text-center">
                  <img src="/Imagenes/logo2.png"
                    style="width: 200px; height: 150px;" alt="logo">
                </div>

                <form method="post" th:action="@{/usuarios/addRegistro}" th:object="${newUserDTO}" enctype="multipart/form-data">
                  <h1>Crea tu cuenta Invincible Body</h1>

                  <div class="form-outline mb-4">
					  	<label for="inputnombre">Nombre</label>
							<input placeholder="Nombre" th:field="*{nombre}" type="text" id="nombre" name="nombre"
								required="true" class="form-control text-grey-900" />

                    
                  </div>
                  <div class="form-outline mb-4">
					  	<label for="inputapellidos">Apellidos</label>
							<input placeholder="Apellidos" th:field="*{apellidos}" type="text" id="apellidos" name="apellidos"
								required="true" class="form-control text-grey-900" />

                    
                  </div>
                  
                  <div class="form-outline mb-4">
					  	<label for="inputapemail">Correo</label>
							<input placeholder="Email" th:field="*{correo}" type="email" id="email" name="email"
								required="true" class="form-control text-grey-900" />

                    
                  </div>
                  
                  <div class="form-outline mb-4">
					 <label for="inputnombre">Usuario</label>
								<input th:field="*{username}" placeholder="Nombre" type="text" id="username"
									name="username" required="true" class="form-control text-grey-900" />
                    
                  </div>
                  
                  <div class="form-row">

							<div class="form-group col-10">
							<label>Sexo</label>
							<br>
								<div class="form-check-inline">
									<input th:field="*{sexo}" class="form-check-input" type="radio" name="flexRadioDefault"
										id="flexRadioDefault1" value="Hombre" required>
									<label class="form-check-label" for="flexRadioDefault1">
										Hombre
									</label>
								</div>
								<div class="form-check-inline">
									<input th:field="*{sexo}" class="form-check-input" type="radio" name="flexRadioDefault"
										id="flexRadioDefault2" value="Mujer" required>
									<label class="form-check-label" for="flexRadioDefault2">
										Mujer
									</label>
								</div>
							</div>

						</div>

                  <div class="form-outline mb-4">
                   <div class="form-group">
                    <label for="password">Contraseña:</label>
                    <div class="input-group">
                        <input th:field="*{password}" type="password" class="form-control" id="password" name="password" required minlength="8">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                <i id="toggleIcon" class="fa fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <small id="passwordHelp" class="form-text text-danger"></small>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirmar contraseña:</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                <i id="toggleConfirmIcon" class="fa fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <small id="confirmPasswordHelp" class="form-text text-danger"></small>
                </div>
                  </div>
                  
                  <div class="form-outline mb-4">
	 						<label for="file">Foto de perfil</label>
	  						<input id="input-file" type="file" name="file" accept="image/png, image/jpeg" />
                    
                  </div>
                  
                  <div class="form-row">

							<div class="form-group col-10">
							<label>Tipo de cuenta</label>
							<br>
								<div class="form-check-inline">
									<input th:field="*{rol}" class="form-check-input" type="radio" name="flexRadioDefault"
										id="flexRadioDefault3" value="Alumno" required>
									<label class="form-check-label" for="flexRadioDefault3">
										Alumno
									</label>
								</div>
								<div class="form-check-inline">
									<input th:field="*{rol}" class="form-check-input" type="radio" name="flexRadioDefault"
										id="flexRadioDefault4" value="Entrenador" required>
									<label class="form-check-label" for="flexRadioDefault4">
										Entrenador
									</label>
								</div>
							</div>

						</div>

                  <div class="text-center pt-1 mb-5 pb-1">
						<input type="submit" value="Acceder" class="btn btn-primary float-right mt-3">
                  </div>

                </form>

              </div>
            </div>
          <div class="dos col-lg-6 col-md-6 col-sm-12 d-flex align-items-center gradient-custom-2"
  style="background-image: url('/Imagenes/registroGif.gif'); background-repeat: no-repeat;
  background-size: cover; background-position: center;">

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="alerta" th:if="${fallo}">[[${fallo}]]</div>
<script>
	$(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
                });
          $("#passwordForm").submit(function (event) {
            event.preventDefault();
            comprobarClave();
        });

        $("#password").on("input", function () {
            validarSeguridadPassword();
        });

        $("#confirmPassword").on("input", function () {
            validarCoincidenciaPasswords();
        });
        
          $("#togglePassword").click(function() {
            togglePasswordVisibility("password", "toggleIcon");
        });

        $("#toggleConfirmPassword").click(function() {
            togglePasswordVisibility("confirmPassword", "toggleConfirmIcon");
        });
    });
    
     function togglePasswordVisibility(inputId, iconId) {
        let input = document.getElementById(inputId);
        let icon = document.getElementById(iconId);

        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash");
        } else {
            input.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
        }
    }
	
    function comprobarClave() {
        let clave1 = $("#password").val();
        let clave2 = $("#confirmPassword").val();
        let alerta = $("#alerta");
        let exito = $("#exito");

        if (clave1 === clave2) {
            if (validarSeguridadPassword()) {
                $("#passwordForm").off("submit");
                exito.show();
            } else {
                alerta.text("La contraseña debe contener al menos 8 caracteres y cumplir con los requisitos de seguridad");
                alerta.show();
            }
        } else {
            alerta.text("Las contraseñas no coinciden");
            alerta.show();
        }
    }

    function validarSeguridadPassword() {
        let password = $("#password").val();
        let passwordHelp = $("#passwordHelp");
        let regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;

        if (password.length < 8) {
            passwordHelp.text("La contraseña debe tener al menos 8 caracteres");
            passwordHelp.addClass("text-danger");
            return false;
        } else if (!regex.test(password)) {
            passwordHelp.text("La contraseña debe contener al menos una letra, un número y un carácter especial (@ $ ! % * # ? &)");
            passwordHelp.addClass("text-danger");
            return false;
        } else {
            passwordHelp.text("");
            passwordHelp.removeClass("text-danger");
            return true;
        }
    }

    function validarCoincidenciaPasswords() {
        let clave1 = $("#password").val();
        let clave2 = $("#confirmPassword").val();
        let confirmPasswordHelp = $("#confirmPasswordHelp");

        if (clave1 !== clave2) {
            confirmPasswordHelp.text("Las contraseñas no coinciden");
            confirmPasswordHelp.addClass("text-danger");
            return false;
        } else {
            confirmPasswordHelp.text("");
            confirmPasswordHelp.removeClass("text-danger");
            return true;
        }
    }
</script>
</body>